<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title>TheMove - Reset Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ["Poppins", "sans-serif"] },
            colors: {
              primary: "#4F46E5",
              accent: "#6366F1",
              background: "#FAFAFA",
              dark: "#1E1B4B",
            },
          },
        },
      };
    </script>
  </head>

  <body class="bg-background font-sans text-gray-800 flex flex-col min-h-screen">
    <!-- ‚úÖ Navbar -->
    <header class="navbar">
      <div class="navbar-container">
        <a href="/" class="navbar-logo">TheMove</a>
      </div>
    </header>

    <!-- ‚úÖ Main Content -->
    <main class="flex-grow flex items-center justify-center py-12 px-4">
      <div class="container container-sm">
        <div class="card max-w-md mx-auto fade-in">
          <h1 class="heading-2 text-center mb-2">Reset Password</h1>
          <p class="text-muted text-center mb-8">Enter your new password below</p>

          <form class="space-y-4" onsubmit="event.preventDefault(); handleResetPassword();">
            <div class="form-group">
              <input
                id="new-password"
                type="password"
                placeholder="New Password"
                class="form-input"
                required
                minlength="6"
              />
            </div>

            <div class="form-group">
              <input
                id="confirm-password"
                type="password"
                placeholder="Confirm Password"
                class="form-input"
                required
                minlength="6"
              />
            </div>

            <button
              id="reset-button"
              type="submit"
              class="btn btn-primary btn-full btn-lg"
            >
              Reset Password
            </button>

            <p class="text-center text-sm text-gray-600 mt-4">
              <a href="/login" class="text-primary hover:underline">Back to Login</a>
            </p>
          </form>

          <div id="toast-container" class="fixed top-4 right-4 z-50"></div>
        </div>
      </div>
    </main>

    <script>
      // Toast function
      function showToast(message, type = "info") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        const colors = {
          success: "bg-green-500",
          error: "bg-red-500",
          warning: "bg-yellow-500",
          info: "bg-blue-500",
        };
        toast.className = `${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg mb-2 animate-fade-in`;
        toast.textContent = message;
        container.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 5000);
      }

      // Get token from URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get("token");

      if (!token) {
        showToast("Invalid reset link. Please request a new password reset.", "error");
        setTimeout(() => {
          window.location.href = "/login";
        }, 2000);
      }

      async function handleResetPassword() {
        const newPassword = document.getElementById("new-password").value.trim();
        const confirmPassword = document.getElementById("confirm-password").value.trim();

        if (!newPassword || !confirmPassword) {
          showToast("‚ö†Ô∏è Please fill in both fields.", "warning");
          return;
        }

        if (newPassword.length < 6) {
          showToast("‚ùå Password must be at least 6 characters.", "error");
          return;
        }

        if (newPassword !== confirmPassword) {
          showToast("‚ùå Passwords do not match.", "error");
          return;
        }

        const button = document.getElementById("reset-button");
        button.disabled = true;
        button.textContent = "Resetting...";

        try {
          const res = await fetch("https://themove-backend-production.up.railway.app/auth/reset-password", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ token, newPassword }),
          });

          const data = await res.json();

          if (data.success) {
            showToast("‚úÖ Password reset successfully! Redirecting to login...", "success");
            setTimeout(() => {
              window.location.href = "/login";
            }, 2000);
          } else {
            showToast(data.message || "Failed to reset password. The link may have expired.", "error");
            button.disabled = false;
            button.textContent = "Reset Password";
          }
        } catch (err) {
          console.error("‚ùå Reset password error:", err);
          showToast("Something went wrong. Please try again.", "error");
          button.disabled = false;
          button.textContent = "Reset Password";
        }
      }
    </script>
    <!-- ‚úÖ Footer -->
    <footer class="mt-auto bg-white py-8 text-center border-t border-gray-200">
      <div class="container">
        <div class="mb-4">
          <span class="font-semibold text-primary text-lg">TheMove</span>
          <p class="text-muted mt-2">Your AI Campus Discovery Platform</p>
        </div>
        <div class="flex justify-center gap-6 mb-4">
          <a href="/contact" class="text-gray-600 hover:text-primary transition">Contact</a>
          <a href="/" class="text-gray-600 hover:text-primary transition">Home</a>
        </div>
        <p class="text-muted">¬© 2025 TheMove. Made with ü©µ at UNC.</p>
      </div>
    </footer>
  </body>
</html>

